#DO ENVS
envs.model <- paste(model, "+ envSES")
m.envs <- mclapply(1:dim(dataSubj)[2], function(x) {as.formula(paste(paste0("dataSubj[,",x,"]"), envs.model, sep=""))})
model.envs <- mclapply(m.envs, function(x) {
foo <- summary(gam(formula = x, data=demo, method="REML"))
}, mc.cores=cores)
val.envs <- t(mcmapply(function(x) {
x$p.table[which(rownames(x$p.table) == "envSES"), 3:4]
}, model.envs))
output[,5:6] <- val.envs
output$names <- names(dataSubj)
output$pfdr.medu <- p.adjust(output$p.medu, "fdr")
output$pfdr.envs <- p.adjust(output$p.envs, "fdr")
return(output)
}
model <- "~ s(ageAtClinicalAssess1, k=4) + sex + race2"
#path <- "/data/joy/BBL/studies/pnc/n1601_dataFreeze/neuroimaging/t1struct/n1601_freesurferSurfaceArea.csv"
#outputarea <- FunctionAnalyze(model, path, cores)
path <- "/data/joy/BBL/studies/pnc/n9498_dataFreeze//clinical//n9498_goassess_itemwise_bifactor_scores_20161219.csv"
outputbifactor <- FunctionAnalyze(model, path, cores)
path <- "/data/joy/BBL/studies/pnc/n9498_dataFreeze//clinical//n9498_goassess_itemwise_corrtraits_scores_20161219.csv"
outputcorrtraits <- FunctionAnalyze(model, path, cores)
#write.csv(outputarea, "~/envsMeduAnalysis/n1601_FsArea_mainmodel.output.csv")
#write.csv(outputbifactor, "~/envsMeduAnalysis/n1601_bifactor_mainmodel.output.csv")
#write.csv(outputcorrtraits, "~/envsMeduAnalysis/n1601_corrtraits_mainmodel.output.csv")
#path <- "/data/joy/BBL/studies/pnc/n1601_dataFreeze/cnb/n1601_cnb_factor_scores_tymoore_20151006.csv"
#outputcnb <- FunctionAnalyze(model, path, cores)
#write.csv(outputcnb, "~/envsMeduAnalysis/n1601_cnb_mainmodel.output.csv")
#outputcnb <- outputcnb[1:13, ]
#png("~/envsMeduAnalysis/envs_cnb.png", res=400, width=12, height=6.7, units="in")
#ggplot(data=outputcnb, aes(x=names, y=t.envs)) +
#  geom_bar(colour="black", stat="identity")+
#  theme_bw() +
#  theme(text = element_text(size=20), axis.text.x = element_text(angle = 90, hjust = 1),
#        axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) +
#  ggtitle("envSES effect in CNB", ) +
#  geom_hline(aes(yintercept = qnorm(1 - (.025)/dim(outputcnb)[1], mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)))
#dev.off()
outputbifactor$names <- c("Anxious-Misery","Psychosis","Behavioral","Fear","Overall Psychopathology")
outputbifactor$names <- factor(outputbifactor$names, levels = c("Overall Psychopathology","Anxious-Misery","Psychosis","Behavioral","Fear"))
png("~/envsMeduAnalysis/n9498Analysis/psycho_envs.png", res=400, width=6.7, height=6.7, units="in")
ggplot(data=outputbifactor, aes(x=names, y=t.envs)) +
geom_bar(aes(fill=names), stat="identity", color="black")+
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1, size=20, vjust= 1),
axis.text.y = element_text(size=20),
axis.title.x=element_blank(),plot.title = element_text(hjust = 0.5)) +
ylab("Association of SES and Psychopathology \n (z-score)") +
ylim(-9,2.5) +
annotate("text",x=1,y=-9, size=6, label="***") +
annotate("text",x=3,y=-9, size=6, label="***") +
annotate("text",x=5,y=-9, size=6, label="*") +
annotate("text",x=4,y=-9, size=6, label="***") + geom_hline(yintercept=0) +
scale_fill_manual(name = "Diagnosis",
values = c("darkgreen","blue", "darkorchid4","red2","gold2"),
guide=FALSE) +
scale_x_discrete(labels=c("Overall \nPsychopathology","Anxious-Misery","Psychosis","Behavioral","Fear"))
dev.off()
png("~/envsMeduAnalysis/n9498Analysis/corrtrait_envs.png", res=400, width=6.7, height=6.7, units="in")
ggplot(data=outputcorrtraits, aes(x=names, y=t.envs)) +
geom_bar(colour="black", stat="identity", fill="gray75")+
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) +
ggtitle("envSES effect in CorrTrait Scores", ) +
geom_hline(aes(yintercept =  - qnorm(1 - (.025)/dim(outputcorrtraits)[1], mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)))
dev.off()
diag <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze/clinical/n9498_goassess_psych_summary_vars_20131014.csv")
diagPS <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze/clinical/n9498_diagnosis_dxpmr_20161014.csv")
diag <- merge(diag, diagPS, by="bblid")
##Make variables where 1 = diagnosis.
#ADHD
diag$Add <- NA
diag$Add[which(diag$smry_add==4)] <- 1
#Agoraphobia
diag$Agr <- NA
diag$Agr[which(diag$smry_agr==4)] <- 1
#Anorexia
diag$Ano <- NA
diag$Ano[which(diag$smry_ano==4)] <- 1
#Bulimia
diag$Bul <- NA
diag$Bul[which(diag$smry_bul==4)] <- 1
#Conduct Disorder
diag$Con <- NA
diag$Con[which(diag$smry_con==4)] <- 1
#Generalized Anxiety Disorder
diag$Gad <- NA
diag$Gad[which(diag$smry_gad==4)] <- 1
#Mania
diag$Man <- NA
diag$Man[which(diag$smry_man==4)] <- 1
#Major Depressive Disorder
diag$Mdd <- NA
diag$Mdd[which(diag$smry_dep==4)] <- 1
#OCD
diag$Ocd <- NA
diag$Ocd[which(diag$smry_ocd==4)] <- 1
#Oppositional Defiant Disorder
diag$Odd <- NA
diag$Odd[which(diag$smry_odd==4)] <- 1
#Panic Disorder
diag$Pan <- NA
diag$Pan[which(diag$smry_pan==4)] <- 1
#Psychosis
diag$Ps <- NA
diag$Ps[which(diag$goassessDxpmr6 == "PS")] <- 1
#Posttraumatic Stress Disorder
diag$Ptd <- NA
diag$Ptd[which(diag$smry_ptd==4)] <- 1
#Separation Anxiety Disorder
diag$Sep <- NA
diag$Sep[which(diag$smry_sep==4)] <- 1
#Social Anxiety Disorder
diag$Soc <- NA
diag$Soc[which(diag$smry_soc==4)] <- 1
#Specific Phobia
diag$Sph <- NA
diag$Sph[which(diag$smry_phb==4)] <- 1
#Typically Developing
dxNames <- c("bblid","Add","Agr","Ano","Bul","Con","Gad","Man","Mdd","Ocd","Odd","Pan","Ps","Ptd","Sep","Soc","Sph")
dxDf <- data.matrix(diag[,dxNames])
diag$totDx <- rowSums(dxDf[,2:17], na.rm=TRUE) #This is how many people have how many diagnoses: sum(totDx==0):414, sum(totDx==1):307, sum(totDx>=2):638
diag$Td <- NA
diag$Td[which(diag$totDx==0)] <- 1
library(psych)
demo <- merge(demo,diag, by="bblid")
describeBy(demo$envSES, demo$Td)
#dxNames <- c("Agr","Ano","Bul","Con","Gad","Man","Mdd","Ocd","Odd","Pan","Ptd","Sep","Soc","Sph","Td")
dxNames <- c("Agr","Con","Gad","Mdd","Ocd","Odd","Ps","Ptd","Sep","Soc","Sph","Td")
t <- describeBy(demo$envSES, demo$Add, mat = T)
t$group1 <- as.character(as.factor(t$group1))
t$group1[1] <- "Add"
for (j in dxNames) {
i <- which(names(demo) == j)
temp <- describeBy(demo$envSES, demo[,i], mat = T)
temp$group1 <- as.character(as.factor(temp$group1))
temp$group1[1] <- j
t <- rbind(t, temp)
}
t$group1 <- c("ADHD","Agoraphobia","Conduct","GAD","MDD","OCD","ODD","Psychosis","PTSD","Sep. Anxiety","Social Anxiety","Specific Phobias","TD")
png("~/envsMeduAnalysis/n9498Analysis/diagnosis_environment.png", res=400, width=13.4, height=6.7, units="in")
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity",fill="orange", col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0)
dev.off()
model <- gam(envSES ~ s(ageAtClinicalAssess1, k=4) + sex + race2, data=demo)
demo$resienvSES <- model$residuals
t <- describeBy(demo$resienvSES, demo$Add, mat = T)
t$group1 <- as.character(as.factor(t$group1))
t$group1[1] <- "Add"
for (j in dxNames) {
i <- which(names(demo) == j)
temp <- describeBy(demo$resienvSES, demo[,i], mat = T)
temp$group1 <- as.character(as.factor(temp$group1))
temp$group1[1] <- j
t <- rbind(t, temp)
}
t$group1 <- c("ADHD","Agoraphobia","Conduct","GAD","MDD","OCD","ODD","Psychosis","PTSD","Sep. Anxiety","Social Anxiety","Specific Phobias","TD")
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray50", high = "gray40") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray40", high = "gray10") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray50", high = "gray10") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray30", high = "gray10") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray60", high = "gray30") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray50", high = "gray30") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray70", high = "gray30") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray80", high = "gray30") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray80", high = "gray20") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray90", high = "gray40") + guides(fill=FALSE)
source('~/.active-rstudio-document', echo=TRUE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0)+ guides(fill=FALSE)
source('~/envsMeduAnalysis/envsAnalysisPNC/n9498_Environment_psych_analysis.R', echo=TRUE)
source('~/envsMeduAnalysis/envsAnalysisPNC/n9498_Environment_psych_analysis.R', echo=TRUE)
source('~/envsMeduAnalysis/envsAnalysisPNC/n9498_Environment_psych_analysis.R', echo=TRUE)
library(parallel)
library(mgcv)
library(e1071)
library(ggplot2)
demo <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze//demographics//n9498_demographics_go1_20161212.csv")
envs <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze//environment//n9498_go1_environment_factor_scores_tymoore_20150909.csv")
tracker <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze//demographics//n9498_demographics_go1_20161212.csv")
tracker <- tracker[c("bblid")]
clinical <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze//clinical//n9498_goassess_itemwise_bifactor_scores_20161219.csv")
health <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze/health/n9498_health_20170405.csv")
health <- health[which(health$medicalrating < 3),]
demo <- merge(tracker, demo, by=c("bblid"))
demo <- merge(demo, envs, by=c("bblid"))
#demo <- merge(demo, volume, by=c("bblid"))
demo <- merge(demo, clinical, by=c("bblid"))
demo <- merge(demo, health, by="bblid")
#healthExclude <- read.csv("/data/joy/BBL/studies/pnc/n1601_dataFreeze/health/n1601_health_20161214.csv")
#T1Exclude <- read.csv("/data/joy/BBL/studies/pnc/n1601_dataFreeze/neuroimaging/t1struct/n1601_t1QaData_v2.csv")
#demo <- merge(demo, healthExclude, by=c("bblid","scanid"))
#demo <- merge(demo, T1Exclude, by=c("bblid","scanid"))
cores <- 1
#demo <- demo[which(demo$ltnExcludev2 == 0), ]
#demo <- demo[which(demo$fsFinalExclude == 0), ]
demo$sex <- as.factor(demo$sex)
demo$race2[which(demo$race2 == 3)] <- 2
demo$race2 <- as.factor(demo$race2)
FunctionAnalyze <- function(model, Path, cores) {
dataSubj <- read.csv(path)
demo.ids <- demo[c("bblid")]
dataSubj <- merge(demo.ids, dataSubj, by=c("bblid"))
dataSubj <- dataSubj[, - which(names(dataSubj) == "bblid")]
#dataSubj <- dataSubj[, - which(names(dataSubj) == "scanid")]
output <- as.data.frame(matrix(NA, nrow = dim(dataSubj)[2], ncol=7))
names(output) <- c("names","t.medu","p.medu","pfdr.medu","t.envs","p.envs","pfdr.envs")
##Do MEDU
medu.model <- paste(model, "+ medu1")
m.medu <- mclapply(1:dim(dataSubj)[2], function(x) {as.formula(paste(paste0("dataSubj[,",x,"]"), medu.model, sep=""))})
model.medu <- mclapply(m.medu, function(x) {
foo <- summary(gam(formula = x, data=demo, method="REML"))
}, mc.cores=cores)
val.medu <- t(mcmapply(function(x) {
x$p.table[which(rownames(x$p.table) == "medu1"), 3:4]
}, model.medu))
output[,2:3] <- val.medu
#DO ENVS
envs.model <- paste(model, "+ envSES")
m.envs <- mclapply(1:dim(dataSubj)[2], function(x) {as.formula(paste(paste0("dataSubj[,",x,"]"), envs.model, sep=""))})
model.envs <- mclapply(m.envs, function(x) {
foo <- summary(gam(formula = x, data=demo, method="REML"))
}, mc.cores=cores)
val.envs <- t(mcmapply(function(x) {
x$p.table[which(rownames(x$p.table) == "envSES"), 3:4]
}, model.envs))
output[,5:6] <- val.envs
output$names <- names(dataSubj)
output$pfdr.medu <- p.adjust(output$p.medu, "fdr")
output$pfdr.envs <- p.adjust(output$p.envs, "fdr")
return(output)
}
model <- "~ s(ageAtClinicalAssess1, k=4) + sex + race2"
#path <- "/data/joy/BBL/studies/pnc/n1601_dataFreeze/neuroimaging/t1struct/n1601_freesurferSurfaceArea.csv"
#outputarea <- FunctionAnalyze(model, path, cores)
path <- "/data/joy/BBL/studies/pnc/n9498_dataFreeze//clinical//n9498_goassess_itemwise_bifactor_scores_20161219.csv"
outputbifactor <- FunctionAnalyze(model, path, cores)
path <- "/data/joy/BBL/studies/pnc/n9498_dataFreeze//clinical//n9498_goassess_itemwise_corrtraits_scores_20161219.csv"
outputcorrtraits <- FunctionAnalyze(model, path, cores)
#write.csv(outputarea, "~/envsMeduAnalysis/n1601_FsArea_mainmodel.output.csv")
#write.csv(outputbifactor, "~/envsMeduAnalysis/n1601_bifactor_mainmodel.output.csv")
#write.csv(outputcorrtraits, "~/envsMeduAnalysis/n1601_corrtraits_mainmodel.output.csv")
#path <- "/data/joy/BBL/studies/pnc/n1601_dataFreeze/cnb/n1601_cnb_factor_scores_tymoore_20151006.csv"
#outputcnb <- FunctionAnalyze(model, path, cores)
#write.csv(outputcnb, "~/envsMeduAnalysis/n1601_cnb_mainmodel.output.csv")
#outputcnb <- outputcnb[1:13, ]
#png("~/envsMeduAnalysis/envs_cnb.png", res=400, width=12, height=6.7, units="in")
#ggplot(data=outputcnb, aes(x=names, y=t.envs)) +
#  geom_bar(colour="black", stat="identity")+
#  theme_bw() +
#  theme(text = element_text(size=20), axis.text.x = element_text(angle = 90, hjust = 1),
#        axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) +
#  ggtitle("envSES effect in CNB", ) +
#  geom_hline(aes(yintercept = qnorm(1 - (.025)/dim(outputcnb)[1], mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)))
#dev.off()
outputbifactor$names <- c("Anxious-Misery","Psychosis","Behavioral","Fear","Overall Psychopathology")
outputbifactor$names <- factor(outputbifactor$names, levels = c("Overall Psychopathology","Anxious-Misery","Psychosis","Behavioral","Fear"))
png("~/envsMeduAnalysis/n9498Analysis/psycho_envs.png", res=400, width=6.7, height=6.7, units="in")
ggplot(data=outputbifactor, aes(x=names, y=t.envs)) +
geom_bar(aes(fill=names), stat="identity", color="black")+
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1, size=20, vjust= 1),
axis.text.y = element_text(size=20),
axis.title.x=element_blank(),plot.title = element_text(hjust = 0.5)) +
ylab("Association of SES and Psychopathology \n (z-score)") +
ylim(-9,2.5) +
annotate("text",x=1,y=-9, size=6, label="***") +
annotate("text",x=3,y=-9, size=6, label="***") +
annotate("text",x=5,y=-9, size=6, label="*") +
annotate("text",x=4,y=-9, size=6, label="***") + geom_hline(yintercept=0) +
scale_fill_manual(name = "Diagnosis",
values = c("darkgreen","blue", "darkorchid4","red2","gold2"),
guide=FALSE) +
scale_x_discrete(labels=c("Overall \nPsychopathology","Anxious-Misery","Psychosis","Behavioral","Fear"))
dev.off()
png("~/envsMeduAnalysis/n9498Analysis/corrtrait_envs.png", res=400, width=6.7, height=6.7, units="in")
ggplot(data=outputcorrtraits, aes(x=names, y=t.envs)) +
geom_bar(colour="black", stat="identity", fill="gray75")+
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) +
ggtitle("envSES effect in CorrTrait Scores", ) +
geom_hline(aes(yintercept =  - qnorm(1 - (.025)/dim(outputcorrtraits)[1], mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)))
dev.off()
diag <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze/clinical/n9498_goassess_psych_summary_vars_20131014.csv")
diagPS <- read.csv("/data/joy/BBL/studies/pnc/n9498_dataFreeze/clinical/n9498_diagnosis_dxpmr_20161014.csv")
diag <- merge(diag, diagPS, by="bblid")
##Make variables where 1 = diagnosis.
#ADHD
diag$Add <- NA
diag$Add[which(diag$smry_add==4)] <- 1
#Agoraphobia
diag$Agr <- NA
diag$Agr[which(diag$smry_agr==4)] <- 1
#Anorexia
diag$Ano <- NA
diag$Ano[which(diag$smry_ano==4)] <- 1
#Bulimia
diag$Bul <- NA
diag$Bul[which(diag$smry_bul==4)] <- 1
#Conduct Disorder
diag$Con <- NA
diag$Con[which(diag$smry_con==4)] <- 1
#Generalized Anxiety Disorder
diag$Gad <- NA
diag$Gad[which(diag$smry_gad==4)] <- 1
#Mania
diag$Man <- NA
diag$Man[which(diag$smry_man==4)] <- 1
#Major Depressive Disorder
diag$Mdd <- NA
diag$Mdd[which(diag$smry_dep==4)] <- 1
#OCD
diag$Ocd <- NA
diag$Ocd[which(diag$smry_ocd==4)] <- 1
#Oppositional Defiant Disorder
diag$Odd <- NA
diag$Odd[which(diag$smry_odd==4)] <- 1
#Panic Disorder
diag$Pan <- NA
diag$Pan[which(diag$smry_pan==4)] <- 1
#Psychosis
diag$Ps <- NA
diag$Ps[which(diag$goassessDxpmr6 == "PS")] <- 1
#Posttraumatic Stress Disorder
diag$Ptd <- NA
diag$Ptd[which(diag$smry_ptd==4)] <- 1
#Separation Anxiety Disorder
diag$Sep <- NA
diag$Sep[which(diag$smry_sep==4)] <- 1
#Social Anxiety Disorder
diag$Soc <- NA
diag$Soc[which(diag$smry_soc==4)] <- 1
#Specific Phobia
diag$Sph <- NA
diag$Sph[which(diag$smry_phb==4)] <- 1
#Typically Developing
dxNames <- c("bblid","Add","Agr","Ano","Bul","Con","Gad","Man","Mdd","Ocd","Odd","Pan","Ps","Ptd","Sep","Soc","Sph")
dxDf <- data.matrix(diag[,dxNames])
diag$totDx <- rowSums(dxDf[,2:17], na.rm=TRUE) #This is how many people have how many diagnoses: sum(totDx==0):414, sum(totDx==1):307, sum(totDx>=2):638
diag$Td <- NA
diag$Td[which(diag$totDx==0)] <- 1
library(psych)
demo <- merge(demo,diag, by="bblid")
describeBy(demo$envSES, demo$Td)
#dxNames <- c("Agr","Ano","Bul","Con","Gad","Man","Mdd","Ocd","Odd","Pan","Ptd","Sep","Soc","Sph","Td")
dxNames <- c("Agr","Con","Gad","Mdd","Ocd","Odd","Ps","Ptd","Sep","Soc","Sph","Td")
t <- describeBy(demo$envSES, demo$Add, mat = T)
t$group1 <- as.character(as.factor(t$group1))
t$group1[1] <- "Add"
for (j in dxNames) {
i <- which(names(demo) == j)
temp <- describeBy(demo$envSES, demo[,i], mat = T)
temp$group1 <- as.character(as.factor(temp$group1))
temp$group1[1] <- j
t <- rbind(t, temp)
}
t$group1 <- c("ADHD","Agoraphobia","Conduct","GAD","MDD","OCD","ODD","Psychosis","PTSD","Sep. Anxiety","Social Anxiety","Specific Phobias","TD")
png("~/envsMeduAnalysis/n9498Analysis/diagnosis_environment.png", res=400, width=13.4, height=6.7, units="in")
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity",fill="orange", col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=20),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0)
dev.off()
model <- gam(envSES ~ s(ageAtClinicalAssess1, k=4) + sex + race2, data=demo)
demo$resienvSES <- model$residuals
t <- describeBy(demo$resienvSES, demo$Add, mat = T)
t$group1 <- as.character(as.factor(t$group1))
t$group1[1] <- "Add"
for (j in dxNames) {
i <- which(names(demo) == j)
temp <- describeBy(demo$resienvSES, demo[,i], mat = T)
temp$group1 <- as.character(as.factor(temp$group1))
temp$group1[1] <- j
t <- rbind(t, temp)
}
t$group1 <- c("ADHD","Agoraphobia","Conduct","GAD","MDD","OCD","ODD","Psychosis","PTSD","Sep. Anxiety","Social Anxiety","Specific Phobias","TD")
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "gray90", high = "gray40") + guides(fill=FALSE)
ggplot(t, aes(x=group1, y=mean)) +
geom_bar(position=position_dodge(), stat="identity", aes(fill=mean), col="black") +
geom_errorbar(aes(ymin=mean-2*se, ymax=mean+2*se), width=.1, position=position_dodge(.9)) +
ylab("Neighborhood-level SES Score") +
xlab("Diagnosis") +
theme_classic() +
theme(text = element_text(size=24),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept=0) +
scale_fill_gradient(low = "skyblue", high = "skyblue4") + guides(fill=FALSE)
source('~/envsMeduAnalysis/envsAnalysisPNC/n9498_Environment_psych_analysis.R', echo=TRUE)
